{
  "permissions": {
    "allow": [
      "Bash(cat *)",
      "Bash(echo *)",
      "Bash(ls *)",
      "Bash(git *)",
      "Bash(npm *)",
      "Bash(npx *)",
      "Bash(./gradlew *)",
      "Bash(docker compose *)",
      "Bash(gh *)",
      "Bash(curl *)",
      "Bash(chmod *)",
      "Bash(python3 *)",
      "Bash(vercel *)",
      "Skill(ccpp:react-patterns)",
      "Skill(ccpp:ui-ux-pro-max)",
      "Skill(ccpp:build-fix)",
      "Skill(ccpp:frontend)",
      "Skill(ccpp:verify)",
      "Skill(ccpp:review)",
      "Skill(ccpp:plan)",
      "Bash(git commit:*)",
      "Bash(lsof:*)",
      "Bash(psql:*)",
      "Bash(docker exec:*)",
      "Bash(pkill:*)",
      "Bash(__NEW_LINE_92c146063a7de7fc__ echo \"\")",
      "Bash(backend/db-migration-point-types.sql << 'EOF'\n-- Add USED and RECLAIMED types to point_ledger type check constraint\nALTER TABLE point_ledger DROP CONSTRAINT IF EXISTS point_ledger_type_check;\nALTER TABLE point_ledger ADD CONSTRAINT point_ledger_type_check \n  CHECK \\(type IN \\('EARN', 'REFUND', 'USED', 'RECLAIMED'\\)\\);\nEOF)",
      "Bash(/dev/null << 'PLAN_CONTENT'\n# ë£°ë › ì·¨ì†Œ ì‹œ í¬ì¸íŠ¸ íšŒìˆ˜ ì˜ˆì • ì‹œìŠ¤í…œ ì„¤ê³„ì„œ\n\n## 1. ë°ì´í„° ëª¨ë¸ ì„¤ê³„\n\n### 1.1 PendingPointRecovery ì—”í‹°í‹°\n\n**ëª©ì **: ë£°ë › ì·¨ì†Œ ì‹œ íšŒìˆ˜í•˜ì§€ ëª»í•œ í¬ì¸íŠ¸ë¥¼ \"ì±„ê¶Œ\"ìœ¼ë¡œ ê¸°ë¡í•˜ê³ , ë‹¤ìŒ í¬ì¸íŠ¸ ì§€ê¸‰ ì‹œ ìë™ ì°¨ê°\n\n**íŒŒì¼**: `backend/src/main/kotlin/com/roulette/domain/point/PendingPointRecovery.kt`\n\n```kotlin\npackage com.roulette.domain.point\n\nimport com.roulette.common.BaseTimeEntity\nimport jakarta.persistence.*\nimport java.time.LocalDateTime\n\nenum class RecoveryStatus {\n    PENDING,    // íšŒìˆ˜ ëŒ€ê¸° ì¤‘\n    COMPLETED   // íšŒìˆ˜ ì™„ë£Œ\n}\n\n@Entity\n@Table\\(\n    name = \"pending_point_recovery\",\n    indexes = [\n        Index\\(name = \"idx_user_status\", columnList = \"user_id, status\"\\)\n    ]\n\\)\nclass PendingPointRecovery\\(\n    @Column\\(name = \"user_id\", nullable = false\\)\n    val userId: Long,\n\n    @Column\\(name = \"roulette_history_id\", nullable = false\\)\n    val rouletteHistoryId: Long,\n\n    @Column\\(name = \"amount_to_recover\", nullable = false\\)\n    var amountToRecover: Int,\n\n    @Enumerated\\(EnumType.STRING\\)\n    @Column\\(nullable = false\\)\n    var status: RecoveryStatus = RecoveryStatus.PENDING,\n\n    @Column\\(name = \"cancelled_at\", nullable = false\\)\n    val cancelledAt: LocalDateTime = LocalDateTime.now\\(\\),\n\n    @Column\\(name = \"completed_at\"\\)\n    var completedAt: LocalDateTime? = null\n\\) : BaseTimeEntity\\(\\) {\n    @Id\n    @GeneratedValue\\(strategy = GenerationType.IDENTITY\\)\n    val id: Long? = null\n\n    /**\n     * íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ì—ì„œ ì§€ì • ê¸ˆì•¡ë§Œí¼ ì°¨ê°\n     * @return ì‹¤ì œ ì°¨ê°ëœ ê¸ˆì•¡\n     */\n    fun deduct\\(amount: Int\\): Int {\n        val actualDeduct = minOf\\(amount, amountToRecover\\)\n        amountToRecover -= actualDeduct\n\n        // ëª¨ë‘ íšŒìˆ˜ë˜ì—ˆìœ¼ë©´ ìƒíƒœ ë³€ê²½\n        if \\(amountToRecover == 0\\) {\n            status = RecoveryStatus.COMPLETED\n            completedAt = LocalDateTime.now\\(\\)\n        }\n\n        return actualDeduct\n    }\n\n    fun isCompleted\\(\\): Boolean = status == RecoveryStatus.COMPLETED\n    fun isPending\\(\\): Boolean = status == RecoveryStatus.PENDING\n}\n```\n\n**í•µì‹¬ ì„¤ê³„ ê²°ì •**:\n- `amountToRecover`: íšŒìˆ˜í•  ë‚¨ì€ ê¸ˆì•¡ \\(ì°¨ê°ë˜ë©´ ê°ì†Œ\\)\n- `status`: PENDING/COMPLETEDë¡œ ìƒíƒœ ì¶”ì \n- `rouletteHistoryId`: ì–´ë–¤ ë£°ë › ì·¨ì†Œë¡œ ë°œìƒí–ˆëŠ”ì§€ ì¶”ì  \\(ê°ì‚¬ìš©\\)\n- `completedAt`: ì™„ì „ íšŒìˆ˜ ì‹œì  ê¸°ë¡\n- **ìœ íš¨ê¸°ê°„ ì—†ìŒ**: í•„ë“œì— expiresAtì´ ì—†ìŒ \\(ìš”êµ¬ì‚¬í•­\\)\n- **ì¸ë±ìŠ¤**: \\(user_id, status\\) ë³µí•© ì¸ë±ìŠ¤ë¡œ PENDING ì¡°íšŒ ìµœì í™”\n\n### 1.2 PendingPointRecoveryRepository\n\n**íŒŒì¼**: `backend/src/main/kotlin/com/roulette/domain/point/PendingPointRecoveryRepository.kt`\n\n```kotlin\npackage com.roulette.domain.point\n\nimport jakarta.persistence.LockModeType\nimport org.springframework.data.jpa.repository.JpaRepository\nimport org.springframework.data.jpa.repository.Lock\nimport org.springframework.data.jpa.repository.Query\nimport org.springframework.data.repository.query.Param\n\ninterface PendingPointRecoveryRepository : JpaRepository<PendingPointRecovery, Long> {\n\n    /**\n     * íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ ì¡°íšŒ \\(ë½ íšë“\\)\n     * - í¬ì¸íŠ¸ ì§€ê¸‰ ì‹œ ë™ì‹œì„± ì œì–´ë¥¼ ìœ„í•´ ë¹„ê´€ì  ë½ ì‚¬ìš©\n     * - ìƒì„±ì¼ ì˜¤ë¦„ì°¨ìˆœ \\(FIFO\\)\n     */\n    @Lock\\(LockModeType.PESSIMISTIC_WRITE\\)\n    @Query\\(\"\"\"\n        SELECT r FROM PendingPointRecovery r\n        WHERE r.userId = :userId\n        AND r.status = 'PENDING'\n        ORDER BY r.createdAt ASC\n    \"\"\"\\)\n    fun findPendingByUserIdForUpdate\\(@Param\\(\"userId\"\\) userId: Long\\): List<PendingPointRecovery>\n\n    /**\n     * íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ í•©ê³„ ì¡°íšŒ \\(ì½ê¸° ì „ìš©\\)\n     */\n    @Query\\(\"\"\"\n        SELECT COALESCE\\(SUM\\(r.amountToRecover\\), 0\\)\n        FROM PendingPointRecovery r\n        WHERE r.userId = :userId\n        AND r.status = 'PENDING'\n    \"\"\"\\)\n    fun sumPendingAmount\\(@Param\\(\"userId\"\\) userId: Long\\): Int\n\n    /**\n     * ìœ ì €ì˜ ëª¨ë“  íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ ì¡°íšŒ \\(ì½ê¸° ì „ìš©\\)\n     */\n    @Query\\(\"\"\"\n        SELECT r FROM PendingPointRecovery r\n        WHERE r.userId = :userId\n        AND r.status = 'PENDING'\n        ORDER BY r.createdAt ASC\n    \"\"\"\\)\n    fun findAllPendingByUserId\\(@Param\\(\"userId\"\\) userId: Long\\): List<PendingPointRecovery>\n}\n```\n\n### 1.3 PointType enum í™•ì¥\n\n**í˜„ì¬**: EARN, REFUND, USED, RECLAIMED\n\n**ì¶”ê°€**: `RECOVERY_DEDUCTION` \\(íšŒìˆ˜ ì˜ˆì • ì°¨ê° ë‚´ì—­ í‘œì‹œìš©\\)\n\n**íŒŒì¼**: `backend/src/main/kotlin/com/roulette/domain/point/PointLedger.kt` \\(ìˆ˜ì •\\)\n\n```kotlin\nenum class PointType {\n    EARN,                  // ë£°ë ›ìœ¼ë¡œ íšë“ \\(ì¦ê°€, +\\)\n    REFUND,               // ì£¼ë¬¸ ì·¨ì†Œë¡œ í™˜ë¶ˆ \\(ì¦ê°€, +\\)\n    USED,                 // ìƒí’ˆ ì£¼ë¬¸ìœ¼ë¡œ ì‚¬ìš© \\(ì°¨ê°, -\\)\n    RECLAIMED,            // ë£°ë › ì·¨ì†Œë¡œ íšŒìˆ˜ \\(ì°¨ê°, -\\)\n    RECOVERY_DEDUCTION    // íšŒìˆ˜ ì˜ˆì • ì°¨ê° \\(ì°¨ê°, -\\) â€” ì‹ ê·œ ì¶”ê°€\n}\n```\n\n### 1.4 DB ë§ˆì´ê·¸ë ˆì´ì…˜\n\n**íŒŒì¼**: `backend/src/main/resources/db/migration/V005__create_pending_point_recovery.sql`\n\n```sql\n-- íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ í…Œì´ë¸”\nCREATE TABLE pending_point_recovery \\(\n    id BIGSERIAL PRIMARY KEY,\n    user_id BIGINT NOT NULL,\n    roulette_history_id BIGINT NOT NULL,\n    amount_to_recover INT NOT NULL CHECK \\(amount_to_recover >= 0\\),\n    status VARCHAR\\(20\\) NOT NULL DEFAULT 'PENDING',\n    cancelled_at TIMESTAMP NOT NULL,\n    completed_at TIMESTAMP,\n    created_at TIMESTAMP NOT NULL DEFAULT NOW\\(\\),\n    updated_at TIMESTAMP NOT NULL DEFAULT NOW\\(\\),\n\n    CONSTRAINT fk_recovery_user FOREIGN KEY \\(user_id\\) REFERENCES users\\(id\\),\n    CONSTRAINT fk_recovery_roulette FOREIGN KEY \\(roulette_history_id\\) REFERENCES roulette_history\\(id\\),\n    CONSTRAINT chk_recovery_status CHECK \\(status IN \\('PENDING', 'COMPLETED'\\)\\)\n\\);\n\n-- ì„±ëŠ¥ ìµœì í™” ì¸ë±ìŠ¤\nCREATE INDEX idx_user_status ON pending_point_recovery\\(user_id, status\\);\nCREATE INDEX idx_roulette_history ON pending_point_recovery\\(roulette_history_id\\);\n\n-- ì½”ë©˜íŠ¸\nCOMMENT ON TABLE pending_point_recovery IS 'ë£°ë › ì·¨ì†Œ ì‹œ íšŒìˆ˜í•˜ì§€ ëª»í•œ í¬ì¸íŠ¸ ê¸°ë¡ \\(ì±„ê¶Œ\\)';\nCOMMENT ON COLUMN pending_point_recovery.amount_to_recover IS 'íšŒìˆ˜í•  ë‚¨ì€ ê¸ˆì•¡ \\(ì°¨ê°ë˜ë©´ ê°ì†Œ\\)';\nCOMMENT ON COLUMN pending_point_recovery.status IS 'PENDING: íšŒìˆ˜ ëŒ€ê¸°, COMPLETED: íšŒìˆ˜ ì™„ë£Œ';\n```\n\n**ì£¼ì˜**: í”„ë¡œì íŠ¸ëŠ” í˜„ì¬ JPAì˜ `ddl-auto: validate` ëª¨ë“œë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ, ì‹¤ì œ ìš´ì˜ì—ì„œëŠ”:\n1. ë¡œì»¬ í™˜ê²½: `ddl-auto: create`ë¡œ í…ŒìŠ¤íŠ¸ í›„ ìŠ¤í‚¤ë§ˆ í™•ì¸\n2. ë°°í¬ í™˜ê²½: ìˆ˜ë™ SQL ì‹¤í–‰ ë˜ëŠ” Flyway/Liquibase ë„ì… ê³ ë ¤\n\n---\n\n## 2. Backend ë¡œì§ ë³€ê²½\n\n### 2.1 AdminService.cancelRoulette\\(\\) ìˆ˜ì •\n\n**í˜„ì¬ ë¡œì§ \\(AdminService.kt:335-404\\)**:\n1. RouletteHistory ìƒíƒœ â†’ CANCELLED\n2. PointLedger ì¡°íšŒ\n3. `reclaimedAmount = pointLedger.balance`\n4. `pointLedger.balance = 0`\n5. RECLAIMED ë ˆì½”ë“œ ìƒì„±\n6. ë‹¹ì¼ì´ë©´ ì˜ˆì‚° ë³µêµ¬\n\n**ìˆ˜ì • í›„ ë¡œì§**:\n1. RouletteHistory ìƒíƒœ â†’ CANCELLED\n2. PointLedger ì¡°íšŒ\n3. `originalAmount = rouletteHistory.amount` \\(ì§€ê¸‰í•œ ì´ ê¸ˆì•¡\\)\n4. `currentBalance = pointLedger.balance` \\(í˜„ì¬ ë‚¨ì€ ê¸ˆì•¡\\)\n5. **ì¦‰ì‹œ íšŒìˆ˜**: `pointLedger.balance = 0`\n6. **ë¶€ì¡±ë¶„ ê³„ì‚°**: `shortfall = originalAmount - currentBalance`\n7. **ë¶€ì¡±ë¶„ì´ ìˆìœ¼ë©´**: `PendingPointRecovery` ìƒì„±\n8. RECLAIMED ë ˆì½”ë“œ ìƒì„± \\(currentBalanceë§Œí¼\\)\n9. ë‹¹ì¼ì´ë©´ ì˜ˆì‚° ë³µêµ¬\n\n**ìˆ˜ì •ëœ ì½”ë“œ** \\(`AdminService.kt:cancelRoulette` ë©”ì†Œë“œ\\):\n\n```kotlin\n@Transactional\nfun cancelRoulette\\(historyId: Long\\): CancelRouletteResponse {\n    val rouletteHistory = rouletteHistoryRepository.findById\\(historyId\\)\n        .orElseThrow { RouletteNotFoundException\\(\\) }\n\n    if \\(!rouletteHistory.isActive\\(\\)\\) {\n        throw RouletteAlreadyCancelledException\\(\\)\n    }\n\n    rouletteHistory.cancel\\(\\)\n\n    // PointLedger ì¡°íšŒ\n    val pointLedger = pointLedgerRepository.findByRouletteHistoryId\\(historyId\\)\n        ?: throw IllegalStateException\\(\"PointLedger not found for roulette history\"\\)\n\n    val originalAmount = rouletteHistory.amount\n    val currentBalance = pointLedger.balance\n    val shortfall = originalAmount - currentBalance\n\n    // 1. í˜„ì¬ ë‚¨ì€ í¬ì¸íŠ¸ ì „ì•¡ íšŒìˆ˜\n    pointLedger.balance = 0\n\n    // 2. ë¶€ì¡±ë¶„ì´ ìˆìœ¼ë©´ PendingPointRecovery ìƒì„±\n    var pendingRecoveryId: Long? = null\n    if \\(shortfall > 0\\) {\n        val pendingRecovery = PendingPointRecovery\\(\n            userId = rouletteHistory.userId,\n            rouletteHistoryId = historyId,\n            amountToRecover = shortfall,\n            cancelledAt = LocalDateTime.now\\(\\)\n        \\)\n        val saved = pendingPointRecoveryRepository.save\\(pendingRecovery\\)\n        pendingRecoveryId = saved.id\n    }\n\n    // 3. RECLAIMED ë ˆì½”ë“œ ìƒì„± \\(í˜„ì¬ íšŒìˆ˜í•œ ê¸ˆì•¡ë§Œ\\)\n    if \\(currentBalance > 0\\) {\n        val reclaimedPointLedger = PointLedger\\(\n            userId = rouletteHistory.userId,\n            amount = -currentBalance,\n            balance = 0,\n            type = PointType.RECLAIMED,\n            issuedAt = LocalDateTime.now\\(\\),\n            expiresAt = LocalDateTime.now\\(\\).plusDays\\(30\\)\n        \\)\n        pointLedgerRepository.save\\(reclaimedPointLedger\\)\n    }\n\n    // 4. PDP-5: ë‹¹ì¼ ì·¨ì†Œë©´ ì˜ˆì‚° ë³µêµ¬\n    val spinDate = rouletteHistory.spinDate\n    val cancelDate = LocalDate.now\\(kstZone\\)\n\n    var budgetRestored = false\n    if \\(spinDate.isEqual\\(cancelDate\\)\\) {\n        val budget = dailyBudgetRepository.findByBudgetDate\\(spinDate\\)\n            ?: throw IllegalStateException\\(\"Budget not found for spin date\"\\)\n        budget.restore\\(originalAmount\\)\n        budgetRestored = true\n    }\n\n    val user = userRepository.findById\\(rouletteHistory.userId\\)\n        .orElseThrow { IllegalStateException\\(\"User not found\"\\) }\n\n    return CancelRouletteResponse\\(\n        historyId = historyId,\n        userId = rouletteHistory.userId,\n        userName = user.nickname,\n        originalAmount = originalAmount,\n        reclaimedAmount = currentBalance,\n        alreadyUsedAmount = originalAmount - currentBalance - shortfall,\n        pendingRecoveryAmount = shortfall,  // ì‹ ê·œ í•„ë“œ\n        pendingRecoveryId = pendingRecoveryId,  // ì‹ ê·œ í•„ë“œ\n        budgetRestored = budgetRestored,\n        message = when {\n            shortfall > 0 -> \"Roulette cancelled. Reclaimed ${currentBalance}p, ${shortfall}p will be recovered from future earnings.\"\n            else -> if \\(budgetRestored\\) {\n                \"Roulette cancelled, ${currentBalance}p reclaimed, budget restored\"\n            } else {\n                \"Roulette cancelled, ${currentBalance}p reclaimed \\(budget not restored - not same day\\)\"\n            }\n        }\n    \\)\n}\n```\n\n**ì£¼ì… í•„ìš”**: ìƒì„±ìì— `pendingPointRecoveryRepository: PendingPointRecoveryRepository` ì¶”ê°€\n\n### 2.2 RouletteService.spin\\(\\) ìˆ˜ì •\n\n**í˜„ì¬ ë¡œì§ \\(RouletteService.kt:38-102\\)**:\n1. ì¤‘ë³µ ì°¸ì—¬ ì²´í¬\n2. ëœë¤ ê¸ˆì•¡ ê²°ì •\n3. ì˜ˆì‚° ì°¨ê°\n4. RouletteHistory ì €ì¥\n5. PointLedger ìƒì„± \\(EARN\\)\n6. ì‘ë‹µ ë°˜í™˜\n\n**ìˆ˜ì • í›„ ë¡œì§**:\n1. ì¤‘ë³µ ì°¸ì—¬ ì²´í¬\n2. ëœë¤ ê¸ˆì•¡ ê²°ì •\n3. ì˜ˆì‚° ì°¨ê°\n4. RouletteHistory ì €ì¥\n5. **íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ ì¡°íšŒ \\(ë½\\)**\n6. **íšŒìˆ˜ ì˜ˆì •ì´ ìˆìœ¼ë©´ ì°¨ê° ì²˜ë¦¬**\n7. **ì‹¤ì œ ì§€ê¸‰ì•¡ = ë‹¹ì²¨ê¸ˆ - íšŒìˆ˜ ì°¨ê°ì•¡**\n8. PointLedger ìƒì„± \\(EARN, balance = ì‹¤ì œ ì§€ê¸‰ì•¡\\)\n9. **íšŒìˆ˜ ì°¨ê° ë‚´ì—­ ê¸°ë¡** \\(RECOVERY_DEDUCTION\\)\n10. ì‘ë‹µ ë°˜í™˜\n\n**ìˆ˜ì •ëœ ì½”ë“œ** \\(`RouletteService.kt:spin` ë©”ì†Œë“œ\\):\n\n```kotlin\n@Transactional\nfun spin\\(userId: Long\\): SpinResponse {\n    val today = LocalDate.now\\(\\)\n\n    // 1. ì¤‘ë³µ ì°¸ì—¬ ì²´í¬\n    if \\(rouletteHistoryRepository.existsByUserIdAndSpinDate\\(userId, today\\)\\) {\n        throw AlreadyParticipatedException\\(\\)\n    }\n\n    // 2. ëœë¤ ê¸ˆì•¡ ê²°ì •\n    val amount = Random.nextInt\\(1, 11\\) * 100\n\n    // 3. Lazy ì˜ˆì‚° ë¦¬ì…‹\n    val budget = getOrCreateTodayBudget\\(today\\)\n\n    // 4. ì˜ˆì‚° ì›ìì  ì°¨ê°\n    val updated = dailyBudgetRepository.decrementRemaining\\(today, amount\\)\n    if \\(updated == 0\\) {\n        throw BudgetExhaustedException\\(\\)\n    }\n\n    // 5. RouletteHistory ì €ì¥\n    val history = try {\n        val saved = rouletteHistoryRepository.save\\(\n            RouletteHistory\\(\n                userId = userId,\n                spinDate = today,\n                amount = amount\n            \\)\n        \\)\n        entityManager.flush\\(\\)\n        saved\n    } catch \\(e: DataIntegrityViolationException\\) {\n        throw AlreadyParticipatedException\\(\\)\n    }\n\n    // 6. íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ ì¡°íšŒ \\(ë½\\)\n    val pendingRecoveries = pendingPointRecoveryRepository.findPendingByUserIdForUpdate\\(userId\\)\n\n    // 7. íšŒìˆ˜ ì˜ˆì •ì´ ìˆìœ¼ë©´ ì°¨ê° ì²˜ë¦¬\n    var totalRecovered = 0\n    var remainingAmount = amount\n\n    for \\(recovery in pendingRecoveries\\) {\n        if \\(remainingAmount <= 0\\) break\n\n        val recovered = recovery.deduct\\(remainingAmount\\)\n        totalRecovered += recovered\n        remainingAmount -= recovered\n    }\n\n    val actualGrantedAmount = amount - totalRecovered\n\n    // 8. PointLedger ìƒì„± \\(EARN, balance = ì‹¤ì œ ì§€ê¸‰ì•¡\\)\n    val now = LocalDateTime.now\\(\\)\n    val expiresAt = now.plusDays\\(30\\)\n    pointLedgerRepository.save\\(\n        PointLedger\\(\n            userId = userId,\n            rouletteHistoryId = history.id,\n            amount = amount,  // ë‹¹ì²¨ê¸ˆ \\(ì›ë³¸\\)\n            balance = actualGrantedAmount,  // ì‹¤ì œ ì§€ê¸‰ì•¡ \\(íšŒìˆ˜ ì°¨ê° í›„\\)\n            type = PointType.EARN,\n            issuedAt = now,\n            expiresAt = expiresAt\n        \\)\n    \\)\n\n    // 9. íšŒìˆ˜ ì°¨ê° ë‚´ì—­ ê¸°ë¡ \\(RECOVERY_DEDUCTION\\)\n    if \\(totalRecovered > 0\\) {\n        val recoveryLedger = PointLedger\\(\n            userId = userId,\n            amount = -totalRecovered,\n            balance = 0,\n            type = PointType.RECOVERY_DEDUCTION,\n            issuedAt = now,\n            expiresAt = now.plusDays\\(30\\)\n        \\)\n        pointLedgerRepository.save\\(recoveryLedger\\)\n    }\n\n    // 10. ì°¨ê° í›„ ì”ì—¬ ì˜ˆì‚° ì¡°íšŒ\n    val updatedBudget = dailyBudgetRepository.findByBudgetDate\\(today\\)\n        ?: throw IllegalStateException\\(\"Budget not found after decrement\"\\)\n\n    return SpinResponse\\(\n        historyId = history.id,\n        amount = amount,\n        actualGrantedAmount = actualGrantedAmount,  // ì‹ ê·œ í•„ë“œ\n        recoveredAmount = totalRecovered,  // ì‹ ê·œ í•„ë“œ\n        remainingBudget = updatedBudget.remaining,\n        message = if \\(totalRecovered > 0\\) {\n            \"${amount}p ë‹¹ì²¨! \\(íšŒìˆ˜ ì˜ˆì • ${totalRecovered}p ì°¨ê°, ì‹¤ì œ ì§€ê¸‰ ${actualGrantedAmount}p\\)\"\n        } else {\n            \"${amount}p ë‹¹ì²¨!\"\n        }\n    \\)\n}\n```\n\n**ì£¼ì… í•„ìš”**: ìƒì„±ìì— `pendingPointRecoveryRepository: PendingPointRecoveryRepository` ì¶”ê°€\n\n### 2.3 PointService í™•ì¥\n\n**ì‹ ê·œ ë©”ì†Œë“œ ì¶”ê°€**: íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ ì¡°íšŒ\n\n**íŒŒì¼**: `backend/src/main/kotlin/com/roulette/domain/point/PointService.kt`\n\n```kotlin\n/**\n * íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ ì¡°íšŒ\n */\nfun getPendingRecovery\\(userId: Long\\): PendingRecoveryResponse {\n    val recoveries = pendingPointRecoveryRepository.findAllPendingByUserId\\(userId\\)\n    val totalAmount = recoveries.sumOf { it.amountToRecover }\n\n    val items = recoveries.map { PendingRecoveryItem.from\\(it\\) }\n\n    return PendingRecoveryResponse\\(\n        totalAmount = totalAmount,\n        items = items\n    \\)\n}\n```\n\n**ì£¼ì… í•„ìš”**: ìƒì„±ìì— `pendingPointRecoveryRepository: PendingPointRecoveryRepository` ì¶”ê°€\n\n### 2.4 íŠ¸ëœì­ì…˜ ê²½ê³„ ëª…í™•í™”\n\n| ì‘ì—… | íŠ¸ëœì­ì…˜ ë²”ìœ„ | ë½ ì‚¬ìš© |\n|---|---|---|\n| **ë£°ë › ì·¨ì†Œ** | RouletteHistory ìƒíƒœ ë³€ê²½ + PointLedger balance íšŒìˆ˜ + PendingPointRecovery INSERT \\(ì¡°ê±´ë¶€\\) + DailyBudget ë³µêµ¬ \\(ì¡°ê±´ë¶€\\) | ì—†ìŒ \\(ë‹¨ì¼ ìœ ì € ì‘ì—…\\) |\n| **ë£°ë › ì°¸ì—¬** | ê¸°ì¡´ ë¡œì§ + PendingPointRecovery ì¡°íšŒ\\(FOR UPDATE\\) + PendingPointRecovery UPDATE + RECOVERY_DEDUCTION ë ˆì½”ë“œ INSERT | PendingPointRecovery \\(PESSIMISTIC_WRITE\\) |\n\n**ë™ì‹œì„± ë³´ì¥**:\n- ë£°ë › ì·¨ì†Œ: ë‹¨ì¼ ìœ ì €ì˜ íŠ¹ì • ë£°ë ›ë§Œ ì·¨ì†Œí•˜ë¯€ë¡œ ë™ì‹œì„± ì´ìŠˆ ì—†ìŒ\n- ë£°ë › ì°¸ì—¬: `findPendingByUserIdForUpdate`ë¡œ íšŒìˆ˜ ì˜ˆì • ë ˆì½”ë“œì— ë½ íšë“, FIFO ìˆœì„œë¡œ ì°¨ê°\n\n---\n\n## 3. API ë³€ê²½\n\n### 3.1 ì‹ ê·œ ì—”ë“œí¬ì¸íŠ¸\n\n**GET /api/user/points/pending-recovery**\n\n**ì„¤ëª…**: íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ ì¡°íšŒ\n\n**ì‘ë‹µ** \\(`PendingRecoveryResponse`\\):\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"totalAmount\": 200,\n    \"items\": [\n      {\n        \"id\": 1,\n        \"rouletteHistoryId\": 42,\n        \"amountToRecover\": 200,\n        \"cancelledAt\": \"2026-02-08T15:30:00\",\n        \"createdAt\": \"2026-02-08T15:30:00\"\n      }\n    ]\n  }\n}\n```\n\n**Controller ì¶”ê°€** \\(`PointController.kt`\\):\n\n```kotlin\n@Operation\\(\n    summary = \"íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ ì¡°íšŒ\",\n    description = \"\"\"\n        ë£°ë › ì·¨ì†Œë¡œ ì¸í•´ íšŒìˆ˜ ì˜ˆì •ì¸ í¬ì¸íŠ¸ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.\n\n        íŠ¹ì§•:\n        - ìœ íš¨ê¸°ê°„ ì—†ìŒ \\(ëˆ„ì  ê°€ëŠ¥\\)\n        - ë‹¤ìŒ í¬ì¸íŠ¸ ì§€ê¸‰ ì‹œ ìë™ ì°¨ê°\n        - íšŒìˆ˜ ì˜ˆì •ì´ ìˆìœ¼ë©´ ì‚¬ìš© ê°€ëŠ¥ ì”ì•¡ = 0\n    \"\"\"\n\\)\n@GetMapping\\(\"/pending-recovery\"\\)\nfun getPendingRecovery\\(\n    @AuthenticationPrincipal sessionUser: SessionUser\n\\): ApiResponse<PendingRecoveryResponse> {\n    val response = pointService.getPendingRecovery\\(sessionUser.id\\)\n    return ApiResponse.success\\(response\\)\n}\n```\n\n### 3.2 ê¸°ì¡´ ì‘ë‹µ ìˆ˜ì •\n\n**CancelRouletteResponse** \\(`admin/dto/CancelRouletteResponse.kt`\\):\n\n```kotlin\ndata class CancelRouletteResponse\\(\n    val historyId: Long,\n    val userId: Long,\n    val userName: String,\n    val originalAmount: Int,\n    val reclaimedAmount: Int,\n    val alreadyUsedAmount: Int,\n    val pendingRecoveryAmount: Int,      // ì‹ ê·œ: íšŒìˆ˜ ì˜ˆì • ê¸ˆì•¡\n    val pendingRecoveryId: Long?,        // ì‹ ê·œ: PendingPointRecovery ID\n    val budgetRestored: Boolean,\n    val message: String\n\\)\n```\n\n**SpinResponse** \\(`roulette/dto/SpinResponse.kt`\\):\n\n```kotlin\ndata class SpinResponse\\(\n    val historyId: Long,\n    val amount: Int,\n    val actualGrantedAmount: Int,        // ì‹ ê·œ: ì‹¤ì œ ì§€ê¸‰ì•¡ \\(íšŒìˆ˜ ì°¨ê° í›„\\)\n    val recoveredAmount: Int,            // ì‹ ê·œ: íšŒìˆ˜ ì˜ˆì •ì—ì„œ ì°¨ê°ëœ ê¸ˆì•¡\n    val remainingBudget: Int,\n    val message: String\n\\)\n```\n\n### 3.3 DTO ì„¤ê³„\n\n**PendingRecoveryResponse** \\(`point/dto/PendingRecoveryResponse.kt`\\):\n\n```kotlin\npackage com.roulette.domain.point.dto\n\nimport com.roulette.domain.point.PendingPointRecovery\nimport java.time.LocalDateTime\n\ndata class PendingRecoveryItem\\(\n    val id: Long,\n    val rouletteHistoryId: Long,\n    val amountToRecover: Int,\n    val cancelledAt: LocalDateTime,\n    val createdAt: LocalDateTime\n\\) {\n    companion object {\n        fun from\\(recovery: PendingPointRecovery\\): PendingRecoveryItem {\n            return PendingRecoveryItem\\(\n                id = recovery.id!!,\n                rouletteHistoryId = recovery.rouletteHistoryId,\n                amountToRecover = recovery.amountToRecover,\n                cancelledAt = recovery.cancelledAt,\n                createdAt = recovery.createdAt\n            \\)\n        }\n    }\n}\n\ndata class PendingRecoveryResponse\\(\n    val totalAmount: Int,\n    val items: List<PendingRecoveryItem>\n\\)\n```\n\n---\n\n## 4. í”„ë¡ íŠ¸ì—”ë“œ/ì–´ë“œë¯¼ UI ë³€ê²½\n\n### 4.1 ì–´ë“œë¯¼ â€” ë£°ë › ì·¨ì†Œ ê²°ê³¼ í‘œì‹œ\n\n**íŒŒì¼**: `admin/src/pages/RouletteHistoryPage.tsx` \\(ì‹ ê·œ í˜ì´ì§€\\)\n\n**ë³€ê²½ ì‚¬í•­**:\n- ì·¨ì†Œ ì„±ê³µ ì‹œ ì‘ë‹µì˜ `pendingRecoveryAmount` í‘œì‹œ\n- ì¡°ê±´ë¶€ ë©”ì‹œì§€:\n  - `pendingRecoveryAmount > 0`: \"ì¼ë¶€ë§Œ íšŒìˆ˜ë¨, ${pendingRecoveryAmount}pëŠ” ë‹¤ìŒ ì§€ê¸‰ ì‹œ ì°¨ê° ì˜ˆì •\"\n  - `pendingRecoveryAmount == 0`: \"ì „ì•¡ íšŒìˆ˜ ì™„ë£Œ\"\n\n**UI ì˜ˆì‹œ**:\n```tsx\n{response.pendingRecoveryAmount > 0 ? \\(\n  <div className=\"bg-yellow-50 border border-yellow-200 rounded p-3\">\n    <p className=\"text-sm text-yellow-800\">\n      âš ï¸ íšŒìˆ˜ ì˜ˆì •: {response.pendingRecoveryAmount}p\n    </p>\n    <p className=\"text-xs text-yellow-600 mt-1\">\n      ì´ë¯¸ ì‚¬ìš©ëœ í¬ì¸íŠ¸ë¡œ ì¸í•´ ì¼ë¶€ë§Œ íšŒìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.\n      ë‚¨ì€ ê¸ˆì•¡ì€ ë‹¤ìŒ í¬ì¸íŠ¸ ì§€ê¸‰ ì‹œ ìë™ìœ¼ë¡œ ì°¨ê°ë©ë‹ˆë‹¤.\n    </p>\n  </div>\n\\) : \\(\n  <div className=\"bg-green-50 border border-green-200 rounded p-3\">\n    <p className=\"text-sm text-green-800\">âœ… ì „ì•¡ íšŒìˆ˜ ì™„ë£Œ</p>\n  </div>\n\\)}\n```\n\n### 4.2 í”„ë¡ íŠ¸ì—”ë“œ â€” í¬ì¸íŠ¸ í˜ì´ì§€ì— \"íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸\" ì„¹ì…˜ ì¶”ê°€\n\n**íŒŒì¼**: `frontend/src/pages/PointsPage.tsx`\n\n**ë³€ê²½ ì‚¬í•­**:\n1. íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ ì¡°íšŒ API í˜¸ì¶œ\n2. ì”ì•¡ ì¹´ë“œ ìƒë‹¨ì— ê²½ê³  ë°°ë„ˆ ì¶”ê°€ \\(íšŒìˆ˜ ì˜ˆì • > 0ì¸ ê²½ìš°\\)\n3. \"íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸\" ì„¹ì…˜ ì¶”ê°€\n\n**UI êµ¬ì¡°**:\n```tsx\n// 1. ê²½ê³  ë°°ë„ˆ \\(íšŒìˆ˜ ì˜ˆì • > 0ì¸ ê²½ìš°\\)\n{pendingRecovery.totalAmount > 0 && \\(\n  <div className=\"bg-orange-100 border border-orange-300 rounded-lg p-4\">\n    <div className=\"flex items-center gap-2\">\n      <span className=\"text-2xl\">âš ï¸</span>\n      <div>\n        <p className=\"font-bold text-orange-900\">íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸: {pendingRecovery.totalAmount}p</p>\n        <p className=\"text-sm text-orange-700\">\n          ì·¨ì†Œëœ ì§€ê¸‰ ê±´ìœ¼ë¡œ ì¸í•´, ë‹¤ìŒ ë£°ë › ë‹¹ì²¨ ì‹œ ìë™ìœ¼ë¡œ ì°¨ê°ë©ë‹ˆë‹¤.\n        </p>\n      </div>\n    </div>\n  </div>\n\\)}\n\n// 2. ì”ì•¡ ì¹´ë“œ \\(íšŒìˆ˜ ì˜ˆì • > 0ì´ë©´ ì‚¬ìš© ë¶ˆê°€ í‘œì‹œ\\)\n<Card>\n  <CardHeader>\n    <CardTitle>ì‚¬ìš© ê°€ëŠ¥ í¬ì¸íŠ¸</CardTitle>\n  </CardHeader>\n  <CardContent>\n    <div className=\"text-center\">\n      <div className=\"text-5xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent\">\n        {pendingRecovery.totalAmount > 0 ? '0p' : `${balance.totalBalance}p`}\n      </div>\n      {pendingRecovery.totalAmount > 0 && \\(\n        <p className=\"text-sm text-gray-600 mt-2\">\n          \\(íšŒìˆ˜ ì˜ˆì •ìœ¼ë¡œ ì¸í•´ ì‚¬ìš© ë¶ˆê°€\\)\n        </p>\n      \\)}\n    </div>\n  </CardContent>\n</Card>\n\n// 3. íšŒìˆ˜ ì˜ˆì • ìƒì„¸ ëª©ë¡ \\(ì ‘ê¸°/í¼ì¹˜ê¸°\\)\n<Accordion>\n  <AccordionItem value=\"pending\">\n    <AccordionTrigger>\n      íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ ìƒì„¸ \\({pendingRecovery.items.length}ê±´\\)\n    </AccordionTrigger>\n    <AccordionContent>\n      {pendingRecovery.items.map\\(item => \\(\n        <div key={item.id} className=\"border-b py-2\">\n          <p className=\"text-sm\">\n            ë£°ë › ì·¨ì†Œ \\(#{item.rouletteHistoryId}\\)\n          </p>\n          <p className=\"text-lg font-bold text-orange-600\">\n            {item.amountToRecover}p\n          </p>\n          <p className=\"text-xs text-gray-500\">\n            {format\\(item.cancelledAt, 'yyyy-MM-dd HH:mm'\\)}\n          </p>\n        </div>\n      \\)\\)}\n    </AccordionContent>\n  </AccordionItem>\n</Accordion>\n```\n\n**API í˜¸ì¶œ**:\n```typescript\nconst { data: pendingRecovery } = useQuery\\({\n  queryKey: ['pending-recovery'],\n  queryFn: async \\(\\) => {\n    const res = await apiClient.get\\('/api/user/points/pending-recovery'\\);\n    return res.data.data;\n  }\n}\\);\n```\n\n### 4.3 í”„ë¡ íŠ¸ì—”ë“œ â€” ë£°ë › ì°¸ì—¬ í›„ íšŒìˆ˜ ì˜ˆì • ì°¨ê° ì•Œë¦¼\n\n**íŒŒì¼**: `frontend/src/pages/RoulettePage.tsx`\n\n**ë³€ê²½ ì‚¬í•­**:\n- ë£°ë › ì°¸ì—¬ ì„±ê³µ ì‹œ ì‘ë‹µì˜ `recoveredAmount` í™•ì¸\n- `recoveredAmount > 0`ì´ë©´ ì•Œë¦¼ í‘œì‹œ\n\n**UI ì˜ˆì‹œ**:\n```tsx\n{spinResponse.recoveredAmount > 0 && \\(\n  <div className=\"bg-blue-100 border border-blue-300 rounded-lg p-4 mt-4\">\n    <p className=\"text-sm text-blue-900\">\n      ğŸ’¡ íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ {spinResponse.recoveredAmount}pê°€ ì°¨ê°ë˜ì—ˆìŠµë‹ˆë‹¤.\n    </p>\n    <p className=\"text-xs text-blue-700 mt-1\">\n      ë‹¹ì²¨ ê¸ˆì•¡: {spinResponse.amount}p â†’ ì‹¤ì œ ì§€ê¸‰: {spinResponse.actualGrantedAmount}p\n    </p>\n  </div>\n\\)}\n```\n\n---\n\n## 5. ì—£ì§€ ì¼€ì´ìŠ¤ ì²˜ë¦¬\n\n### 5.1 ì—¬ëŸ¬ ë£°ë › ì·¨ì†Œë¡œ íšŒìˆ˜ ì˜ˆì • ëˆ„ì \n\n**ì‹œë‚˜ë¦¬ì˜¤**:\n- ë£°ë › A ì·¨ì†Œ â†’ íšŒìˆ˜ ì˜ˆì • 200p\n- ë£°ë › B ì·¨ì†Œ â†’ íšŒìˆ˜ ì˜ˆì • 300p\n- ì´ íšŒìˆ˜ ì˜ˆì •: 500p\n\n**ì²˜ë¦¬**:\n- `PendingPointRecovery` í…Œì´ë¸”ì— ë³„ë„ í–‰ìœ¼ë¡œ ê¸°ë¡\n- `sumPendingAmount`ë¡œ í•©ê³„ ì¡°íšŒ\n- ì°¨ê° ì‹œ FIFO \\(createdAt ASC\\) ìˆœì„œë¡œ ì²˜ë¦¬\n\n**í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤**:\n```kotlin\n@Test\nfun `ì—¬ëŸ¬ ë£°ë › ì·¨ì†Œë¡œ íšŒìˆ˜ ì˜ˆì • ëˆ„ì `\\(\\) {\n    // Given: ì”ì•¡ 500p, ë£°ë › A\\(1000p\\), ë£°ë › B\\(800p\\) ì§€ê¸‰\n    // When: ë£°ë › A ì·¨ì†Œ \\(íšŒìˆ˜ ì˜ˆì • 500p\\), ë£°ë › B ì·¨ì†Œ \\(íšŒìˆ˜ ì˜ˆì • 800p\\)\n    // Then: ì´ íšŒìˆ˜ ì˜ˆì • 1300p\n\n    val totalPending = pendingPointRecoveryRepository.sumPendingAmount\\(userId\\)\n    assertThat\\(totalPending\\).isEqualTo\\(1300\\)\n}\n```\n\n### 5.2 íšŒìˆ˜ ì˜ˆì •ì´ ì§€ê¸‰ì•¡ë³´ë‹¤ í° ê²½ìš°\n\n**ì‹œë‚˜ë¦¬ì˜¤**:\n- íšŒìˆ˜ ì˜ˆì •: 1500p\n- ë‹¤ìŒ ë£°ë › ë‹¹ì²¨: 500p\n- ê²°ê³¼: 500p ì „ì•¡ ì°¨ê°, ì‚¬ìš© ê°€ëŠ¥ ì”ì•¡ = 0p, íšŒìˆ˜ ì˜ˆì • ì”ì—¬ = 1000p\n\n**ì²˜ë¦¬**:\n- `PendingPointRecovery.deduct\\(500\\)` â†’ 500p ì°¨ê°, amountToRecover = 1000p, status = PENDING\n- `SpinResponse.actualGrantedAmount = 0`\n- PointLedger \\(EARN\\): balance = 0\n- PointLedger \\(RECOVERY_DEDUCTION\\): amount = -500\n\n**ì‚¬ìš©ì ê²½í—˜**:\n- \"500p ë‹¹ì²¨! \\(íšŒìˆ˜ ì˜ˆì • 500p ì°¨ê°, ì‹¤ì œ ì§€ê¸‰ 0p\\)\"\n- í¬ì¸íŠ¸ í˜ì´ì§€: \"ì‚¬ìš© ê°€ëŠ¥ í¬ì¸íŠ¸: 0p \\(íšŒìˆ˜ ì˜ˆì •ìœ¼ë¡œ ì¸í•´ ì‚¬ìš© ë¶ˆê°€\\)\"\n\n**í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤**:\n```kotlin\n@Test\nfun `íšŒìˆ˜ ì˜ˆì •ì´ ì§€ê¸‰ì•¡ë³´ë‹¤ í° ê²½ìš°`\\(\\) {\n    // Given: íšŒìˆ˜ ì˜ˆì • 1500p\n    // When: ë£°ë › ì°¸ì—¬ \\(500p ë‹¹ì²¨\\)\n    // Then: ì‹¤ì œ ì§€ê¸‰ 0p, íšŒìˆ˜ ì˜ˆì • ì”ì—¬ 1000p\n\n    val response = rouletteService.spin\\(userId\\)\n    assertThat\\(response.actualGrantedAmount\\).isEqualTo\\(0\\)\n    assertThat\\(response.recoveredAmount\\).isEqualTo\\(500\\)\n\n    val remainingPending = pendingPointRecoveryRepository.sumPendingAmount\\(userId\\)\n    assertThat\\(remainingPending\\).isEqualTo\\(1000\\)\n}\n```\n\n### 5.3 ë™ì‹œì„± ì‹œë‚˜ë¦¬ì˜¤\n\n#### ì‹œë‚˜ë¦¬ì˜¤ 1: ë™ì¼ ìœ ì €ì˜ ë™ì‹œ ë£°ë › ì°¸ì—¬\n\n**ìƒí™©**: ìœ ì € Aê°€ íšŒìˆ˜ ì˜ˆì • 500pë¥¼ ê°€ì§„ ìƒíƒœì—ì„œ 2ê°œì˜ ë£°ë › ìš”ì²­ ë™ì‹œ ë°œìƒ\n\n**ì²˜ë¦¬**:\n- `UNIQUE\\(user_id, spin_date\\)` ì œì•½ìœ¼ë¡œ 1ê±´ë§Œ ì„±ê³µ\n- `findPendingByUserIdForUpdate`ì˜ ë¹„ê´€ì  ë½ìœ¼ë¡œ íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ ë™ì‹œ ì°¨ê° ë°©ì§€\n\n**ê²°ê³¼**: 1ê±´ë§Œ íšŒìˆ˜ ì˜ˆì • ì°¨ê°, ë‚˜ë¨¸ì§€ëŠ” `AlreadyParticipatedException`\n\n#### ì‹œë‚˜ë¦¬ì˜¤ 2: ë£°ë › ì·¨ì†Œì™€ ë™ì‹œ ì°¸ì—¬\n\n**ìƒí™©**: \n- ìŠ¤ë ˆë“œ A: ë£°ë › ì·¨ì†Œ \\(PendingPointRecovery INSERT\\)\n- ìŠ¤ë ˆë“œ B: ë™ì‹œì— ë£°ë › ì°¸ì—¬ \\(PendingPointRecovery ì¡°íšŒ\\)\n\n**ì²˜ë¦¬**:\n- íŠ¸ëœì­ì…˜ ê²©ë¦¬ ìˆ˜ì¤€: READ_COMMITTED \\(Spring Boot ê¸°ë³¸\\)\n- ìŠ¤ë ˆë“œ Bê°€ ë½ì„ íšë“í•˜ëŠ” ì‹œì ì— ë”°ë¼:\n  - ìŠ¤ë ˆë“œ A ì»¤ë°‹ ì „: íšŒìˆ˜ ì˜ˆì • ì¡°íšŒ ì•ˆ ë¨ â†’ ì „ì•¡ ì§€ê¸‰\n  - ìŠ¤ë ˆë“œ A ì»¤ë°‹ í›„: íšŒìˆ˜ ì˜ˆì • ì¡°íšŒë¨ â†’ ì°¨ê° í›„ ì§€ê¸‰\n\n**ê²°ê³¼**: ë‘˜ ë‹¤ ì •í•©ì„± ë³´ì¥ \\(ìµœì•…ì˜ ê²½ìš° ì°¨ê°ì´ ë‹¤ìŒ ì°¸ì—¬ë¡œ ë¯¸ë¤„ì§\\)\n\n#### ì‹œë‚˜ë¦¬ì˜¤ 3: ë™ì¼ ë£°ë › ë™ì‹œ ì·¨ì†Œ \\(ê´€ë¦¬ì 2ëª…\\)\n\n**ìƒí™©**: ì–´ë“œë¯¼ A, Bê°€ ë™ì¼ ë£°ë ›ì„ ë™ì‹œì— ì·¨ì†Œ ì‹œë„\n\n**ì²˜ë¦¬**:\n- `RouletteHistory.isActive\\(\\)` ì²´í¬\n- ì²« ë²ˆì§¸ íŠ¸ëœì­ì…˜ì´ statusë¥¼ CANCELLEDë¡œ ë³€ê²½\n- ë‘ ë²ˆì§¸ íŠ¸ëœì­ì…˜ì€ `RouletteAlreadyCancelledException` ë°œìƒ\n\n**ê²°ê³¼**: ì¤‘ë³µ ì·¨ì†Œ ë°©ì§€\n\n### 5.4 íšŒìˆ˜ ì˜ˆì •ì´ ìˆëŠ”ë° ì£¼ë¬¸ ì‹œë„\n\n**ì‹œë‚˜ë¦¬ì˜¤**: íšŒìˆ˜ ì˜ˆì • 500p, ì‚¬ìš© ê°€ëŠ¥ ì”ì•¡ 300pì¸ ìƒíƒœì—ì„œ 200p ìƒí’ˆ ì£¼ë¬¸ ì‹œë„\n\n**ìš”êµ¬ì‚¬í•­**: \"íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ê°€ ìˆìœ¼ë©´ ì‚¬ìš© ê°€ëŠ¥ ì”ì•¡ = 0\"\n\n**ì²˜ë¦¬ ë°©ì•ˆ \\(ì„ íƒ\\)**:\n\n**ì˜µì…˜ 1: ì”ì•¡ ì¡°íšŒ ì‹œ ì°¨ë‹¨ \\(ì¶”ì²œ\\)**\n- `PointService.getBalance\\(\\)` ìˆ˜ì •:\n  ```kotlin\n  val pendingAmount = pendingPointRecoveryRepository.sumPendingAmount\\(userId\\)\n  val effectiveBalance = if \\(pendingAmount > 0\\) 0 else totalBalance\n  ```\n- UI: íšŒìˆ˜ ì˜ˆì • > 0ì´ë©´ \"ì£¼ë¬¸í•˜ê¸°\" ë²„íŠ¼ ë¹„í™œì„±í™”\n\n**ì˜µì…˜ 2: ì£¼ë¬¸ ì‹œë„ ì‹œ ì°¨ë‹¨**\n- `OrderService.createOrder\\(\\)` ì‹œì‘ ë¶€ë¶„ì— ì²´í¬:\n  ```kotlin\n  val pendingAmount = pendingPointRecoveryRepository.sumPendingAmount\\(userId\\)\n  if \\(pendingAmount > 0\\) {\n      throw PendingRecoveryExistsException\\(\\)\n  }\n  ```\n- ì—ëŸ¬ ì½”ë“œ: `PENDING_RECOVERY_EXISTS`\n- ë©”ì‹œì§€: \"íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ê°€ ìˆì–´ ì£¼ë¬¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ìŒ ë£°ë › ì°¸ì—¬ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.\"\n\n**ê¶Œì¥**: ì˜µì…˜ 1 \\(UI ì°¨ë‹¨\\) + ì˜µì…˜ 2 \\(ë°±ì—”ë“œ ê²€ì¦\\) ëª¨ë‘ ì ìš©\n\n---\n\n## 6. í…ŒìŠ¤íŠ¸ ì „ëµ\n\n### 6.1 ë‹¨ìœ„ í…ŒìŠ¤íŠ¸\n\n**PendingPointRecovery ì—”í‹°í‹° í…ŒìŠ¤íŠ¸**:\n```kotlin\n@Test\nfun `deduct - ë¶€ë¶„ ì°¨ê°`\\(\\) {\n    val recovery = PendingPointRecovery\\(\n        userId = 1L,\n        rouletteHistoryId = 1L,\n        amountToRecover = 500\n    \\)\n\n    val deducted = recovery.deduct\\(300\\)\n\n    assertThat\\(deducted\\).isEqualTo\\(300\\)\n    assertThat\\(recovery.amountToRecover\\).isEqualTo\\(200\\)\n    assertThat\\(recovery.status\\).isEqualTo\\(RecoveryStatus.PENDING\\)\n}\n\n@Test\nfun `deduct - ì „ì•¡ ì°¨ê° ì‹œ ìƒíƒœ COMPLETED`\\(\\) {\n    val recovery = PendingPointRecovery\\(\n        userId = 1L,\n        rouletteHistoryId = 1L,\n        amountToRecover = 500\n    \\)\n\n    recovery.deduct\\(500\\)\n\n    assertThat\\(recovery.amountToRecover\\).isEqualTo\\(0\\)\n    assertThat\\(recovery.status\\).isEqualTo\\(RecoveryStatus.COMPLETED\\)\n    assertThat\\(recovery.completedAt\\).isNotNull\\(\\)\n}\n\n@Test\nfun `deduct - ì°¨ê° ìš”ì²­ ê¸ˆì•¡ì´ ì”ì•¡ë³´ë‹¤ í° ê²½ìš°`\\(\\) {\n    val recovery = PendingPointRecovery\\(\n        userId = 1L,\n        rouletteHistoryId = 1L,\n        amountToRecover = 300\n    \\)\n\n    val deducted = recovery.deduct\\(500\\)\n\n    assertThat\\(deducted\\).isEqualTo\\(300\\)  // ì‹¤ì œ ì°¨ê° ê°€ëŠ¥í•œ ê¸ˆì•¡ë§Œ\n    assertThat\\(recovery.amountToRecover\\).isEqualTo\\(0\\)\n    assertThat\\(recovery.status\\).isEqualTo\\(RecoveryStatus.COMPLETED\\)\n}\n```\n\n### 6.2 í†µí•© í…ŒìŠ¤íŠ¸\n\n**AdminService.cancelRoulette í…ŒìŠ¤íŠ¸**:\n```kotlin\n@Test\nfun `ë£°ë › ì·¨ì†Œ - í¬ì¸íŠ¸ ì „ì•¡ ë‚¨ì•„ìˆëŠ” ê²½ìš°`\\(\\) {\n    // Given: 1000p ì§€ê¸‰, ì‚¬ìš© ë‚´ì—­ ì—†ìŒ\n    val history = createRouletteHistory\\(userId, 1000\\)\n\n    // When: ë£°ë › ì·¨ì†Œ\n    val response = adminService.cancelRoulette\\(history.id\\)\n\n    // Then\n    assertThat\\(response.reclaimedAmount\\).isEqualTo\\(1000\\)\n    assertThat\\(response.pendingRecoveryAmount\\).isEqualTo\\(0\\)\n    assertThat\\(response.pendingRecoveryId\\).isNull\\(\\)\n\n    val pendingTotal = pendingPointRecoveryRepository.sumPendingAmount\\(userId\\)\n    assertThat\\(pendingTotal\\).isEqualTo\\(0\\)\n}\n\n@Test\nfun `ë£°ë › ì·¨ì†Œ - í¬ì¸íŠ¸ ì¼ë¶€ ì‚¬ìš©ëœ ê²½ìš°`\\(\\) {\n    // Given: 1000p ì§€ê¸‰, 600p ì‚¬ìš© \\(balance = 400p\\)\n    val history = createRouletteHistory\\(userId, 1000\\)\n    usePoints\\(userId, 600\\)\n\n    // When: ë£°ë › ì·¨ì†Œ\n    val response = adminService.cancelRoulette\\(history.id\\)\n\n    // Then\n    assertThat\\(response.reclaimedAmount\\).isEqualTo\\(400\\)  // ë‚¨ì€ í¬ì¸íŠ¸ íšŒìˆ˜\n    assertThat\\(response.pendingRecoveryAmount\\).isEqualTo\\(600\\)  // ë¶€ì¡±ë¶„ â†’ íšŒìˆ˜ ì˜ˆì •\n    assertThat\\(response.pendingRecoveryId\\).isNotNull\\(\\)\n\n    val pendingTotal = pendingPointRecoveryRepository.sumPendingAmount\\(userId\\)\n    assertThat\\(pendingTotal\\).isEqualTo\\(600\\)\n}\n\n@Test\nfun `ë£°ë › ì·¨ì†Œ - í¬ì¸íŠ¸ ì „ì•¡ ì‚¬ìš©ëœ ê²½ìš°`\\(\\) {\n    // Given: 1000p ì§€ê¸‰, 1000p ì‚¬ìš© \\(balance = 0p\\)\n    val history = createRouletteHistory\\(userId, 1000\\)\n    usePoints\\(userId, 1000\\)\n\n    // When: ë£°ë › ì·¨ì†Œ\n    val response = adminService.cancelRoulette\\(history.id\\)\n\n    // Then\n    assertThat\\(response.reclaimedAmount\\).isEqualTo\\(0\\)\n    assertThat\\(response.pendingRecoveryAmount\\).isEqualTo\\(1000\\)\n\n    val pendingTotal = pendingPointRecoveryRepository.sumPendingAmount\\(userId\\)\n    assertThat\\(pendingTotal\\).isEqualTo\\(1000\\)\n}\n```\n\n**RouletteService.spin í…ŒìŠ¤íŠ¸**:\n```kotlin\n@Test\nfun `ë£°ë › ì°¸ì—¬ - íšŒìˆ˜ ì˜ˆì • ì—†ëŠ” ê²½ìš°`\\(\\) {\n    // When: ë£°ë › ì°¸ì—¬\n    val response = rouletteService.spin\\(userId\\)\n\n    // Then\n    assertThat\\(response.actualGrantedAmount\\).isEqualTo\\(response.amount\\)\n    assertThat\\(response.recoveredAmount\\).isEqualTo\\(0\\)\n\n    val balance = pointLedgerRepository.sumAvailableBalance\\(userId\\)\n    assertThat\\(balance\\).isEqualTo\\(response.amount\\)\n}\n\n@Test\nfun `ë£°ë › ì°¸ì—¬ - íšŒìˆ˜ ì˜ˆì • ìˆê³  ë‹¹ì²¨ê¸ˆì´ íšŒìˆ˜ ì˜ˆì •ë³´ë‹¤ í° ê²½ìš°`\\(\\) {\n    // Given: íšŒìˆ˜ ì˜ˆì • 300p\n    createPendingRecovery\\(userId, 300\\)\n\n    // When: ë£°ë › ì°¸ì—¬ \\(ê°€ì •: 500p ë‹¹ì²¨\\)\n    val response = rouletteService.spin\\(userId\\)\n    assume\\(\\).that\\(response.amount\\).isAtLeast\\(300\\)  // í…ŒìŠ¤íŠ¸ ì¡°ê±´\n\n    // Then\n    assertThat\\(response.recoveredAmount\\).isEqualTo\\(300\\)\n    assertThat\\(response.actualGrantedAmount\\).isEqualTo\\(response.amount - 300\\)\n\n    val pendingTotal = pendingPointRecoveryRepository.sumPendingAmount\\(userId\\)\n    assertThat\\(pendingTotal\\).isEqualTo\\(0\\)  // ì „ì•¡ íšŒìˆ˜ ì™„ë£Œ\n}\n\n@Test\nfun `ë£°ë › ì°¸ì—¬ - íšŒìˆ˜ ì˜ˆì •ì´ ë‹¹ì²¨ê¸ˆë³´ë‹¤ í° ê²½ìš°`\\(\\) {\n    // Given: íšŒìˆ˜ ì˜ˆì • 800p\n    createPendingRecovery\\(userId, 800\\)\n\n    // When: ë£°ë › ì°¸ì—¬ \\(ê°€ì •: 500p ë‹¹ì²¨\\)\n    val response = rouletteService.spin\\(userId\\)\n    assume\\(\\).that\\(response.amount\\).isLessThan\\(800\\)  // í…ŒìŠ¤íŠ¸ ì¡°ê±´\n\n    // Then\n    assertThat\\(response.recoveredAmount\\).isEqualTo\\(response.amount\\)\n    assertThat\\(response.actualGrantedAmount\\).isEqualTo\\(0\\)\n\n    val pendingTotal = pendingPointRecoveryRepository.sumPendingAmount\\(userId\\)\n    assertThat\\(pendingTotal\\).isEqualTo\\(800 - response.amount\\)  // ì”ì—¬ íšŒìˆ˜ ì˜ˆì •\n\n    val balance = pointLedgerRepository.sumAvailableBalance\\(userId\\)\n    assertThat\\(balance\\).isEqualTo\\(0\\)  // ì‚¬ìš© ê°€ëŠ¥ ì”ì•¡ 0\n}\n\n@Test\nfun `ë£°ë › ì°¸ì—¬ - ì—¬ëŸ¬ íšŒìˆ˜ ì˜ˆì • ê±´ FIFO ì°¨ê°`\\(\\) {\n    // Given: íšŒìˆ˜ ì˜ˆì • 200p \\(ê±´1\\), 300p \\(ê±´2\\)\n    val recovery1 = createPendingRecovery\\(userId, 200\\)\n    Thread.sleep\\(10\\)  // ìƒì„± ì‹œê°„ ì°¨ì´\n    val recovery2 = createPendingRecovery\\(userId, 300\\)\n\n    // When: ë£°ë › ì°¸ì—¬ \\(ê°€ì •: 400p ë‹¹ì²¨\\)\n    val response = rouletteService.spin\\(userId\\)\n    assume\\(\\).that\\(response.amount\\).isEqualTo\\(400\\)\n\n    // Then: ê±´1 ì „ì•¡\\(200\\) + ê±´2 ì¼ë¶€\\(200\\) ì°¨ê°\n    val updatedRecovery1 = pendingPointRecoveryRepository.findById\\(recovery1.id!!\\).get\\(\\)\n    assertThat\\(updatedRecovery1.amountToRecover\\).isEqualTo\\(0\\)\n    assertThat\\(updatedRecovery1.status\\).isEqualTo\\(RecoveryStatus.COMPLETED\\)\n\n    val updatedRecovery2 = pendingPointRecoveryRepository.findById\\(recovery2.id!!\\).get\\(\\)\n    assertThat\\(updatedRecovery2.amountToRecover\\).isEqualTo\\(100\\)\n    assertThat\\(updatedRecovery2.status\\).isEqualTo\\(RecoveryStatus.PENDING\\)\n}\n```\n\n### 6.3 ë™ì‹œì„± í…ŒìŠ¤íŠ¸\n\n**ë™ì‹œ ë£°ë › ì°¸ì—¬ + íšŒìˆ˜ ì˜ˆì • ì°¨ê°**:\n```kotlin\n@Test\nfun `ë™ì‹œ ë£°ë › ì°¸ì—¬ - íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ ë½ í…ŒìŠ¤íŠ¸`\\(\\) {\n    // Given: íšŒìˆ˜ ì˜ˆì • 1000p\n    createPendingRecovery\\(userId, 1000\\)\n\n    // When: ë™ì¼ ìœ ì €ì˜ 2ê°œ ìš”ì²­ ë™ì‹œ ì‹¤í–‰\n    val executor = Executors.newFixedThreadPool\\(2\\)\n    val latch = CountDownLatch\\(2\\)\n    val results = ConcurrentHashMap<String, Boolean>\\(\\)\n\n    repeat\\(2\\) { index ->\n        executor.submit {\n            try {\n                rouletteService.spin\\(userId\\)\n                results[\"thread-$index\"] = true\n            } catch \\(e: AlreadyParticipatedException\\) {\n                results[\"thread-$index\"] = false\n            } finally {\n                latch.countDown\\(\\)\n            }\n        }\n    }\n\n    latch.await\\(10, TimeUnit.SECONDS\\)\n    executor.shutdown\\(\\)\n\n    // Then: 1ê±´ë§Œ ì„±ê³µ\n    assertThat\\(results.values.count { it }\\).isEqualTo\\(1\\)\n\n    // íšŒìˆ˜ ì˜ˆì • ì°¨ê° í™•ì¸\n    val pendingTotal = pendingPointRecoveryRepository.sumPendingAmount\\(userId\\)\n    assertThat\\(pendingTotal\\).isLessThan\\(1000\\)  // ì¼ë¶€ ì°¨ê°ë¨\n}\n```\n\n**ë™ì‹œ ë£°ë › ì·¨ì†Œ**:\n```kotlin\n@Test\nfun `ë™ì‹œ ë£°ë › ì·¨ì†Œ - ì¤‘ë³µ ë°©ì§€`\\(\\) {\n    // Given: ë£°ë › 1ê±´\n    val history = createRouletteHistory\\(userId, 1000\\)\n\n    // When: ë™ì‹œ ì·¨ì†Œ ì‹œë„\n    val executor = Executors.newFixedThreadPool\\(2\\)\n    val latch = CountDownLatch\\(2\\)\n    val results = ConcurrentHashMap<String, Boolean>\\(\\)\n\n    repeat\\(2\\) { index ->\n        executor.submit {\n            try {\n                adminService.cancelRoulette\\(history.id\\)\n                results[\"thread-$index\"] = true\n            } catch \\(e: RouletteAlreadyCancelledException\\) {\n                results[\"thread-$index\"] = false\n            } finally {\n                latch.countDown\\(\\)\n            }\n        }\n    }\n\n    latch.await\\(10, TimeUnit.SECONDS\\)\n    executor.shutdown\\(\\)\n\n    // Then: 1ê±´ë§Œ ì„±ê³µ\n    assertThat\\(results.values.count { it }\\).isEqualTo\\(1\\)\n\n    // PendingPointRecoveryëŠ” 1ê±´ë§Œ ìƒì„±\n    val allRecoveries = pendingPointRecoveryRepository.findAllPendingByUserId\\(userId\\)\n    assertThat\\(allRecoveries\\).hasSize\\(1\\)\n}\n```\n\n### 6.4 ì—”ë“œíˆ¬ì—”ë“œ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸\n\n**ì‹œë‚˜ë¦¬ì˜¤: ë£°ë › ì§€ê¸‰ â†’ ì¼ë¶€ ì‚¬ìš© â†’ ì·¨ì†Œ â†’ ë‹¤ìŒ ë£°ë › ì°¸ì—¬ â†’ íšŒìˆ˜ ì°¨ê°**:\n```kotlin\n@Test\nfun `E2E - ë£°ë › ì·¨ì†Œ í›„ íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ ì°¨ê°`\\(\\) {\n    // 1. ë£°ë › ì°¸ì—¬ \\(1000p ì§€ê¸‰\\)\n    val spin1 = rouletteService.spin\\(userId\\)\n    assertThat\\(spin1.amount\\).isEqualTo\\(1000\\)\n\n    // 2. í¬ì¸íŠ¸ ì¼ë¶€ ì‚¬ìš© \\(700p\\)\n    usePoints\\(userId, 700\\)\n\n    // 3. ë£°ë › ì·¨ì†Œ \\(íšŒìˆ˜ ì˜ˆì • 700p ë°œìƒ\\)\n    val cancelResponse = adminService.cancelRoulette\\(spin1.historyId\\)\n    assertThat\\(cancelResponse.reclaimedAmount\\).isEqualTo\\(300\\)\n    assertThat\\(cancelResponse.pendingRecoveryAmount\\).isEqualTo\\(700\\)\n\n    // 4. ë‹¤ìŒ ë‚  ë£°ë › ì°¸ì—¬ \\(500p ë‹¹ì²¨ ê°€ì •\\)\n    advanceTimeToNextDay\\(\\)\n    val spin2 = rouletteService.spin\\(userId\\)\n    assume\\(\\).that\\(spin2.amount\\).isEqualTo\\(500\\)\n\n    // 5. ê²€ì¦: 500p ì „ì•¡ íšŒìˆ˜ ì°¨ê°\n    assertThat\\(spin2.recoveredAmount\\).isEqualTo\\(500\\)\n    assertThat\\(spin2.actualGrantedAmount\\).isEqualTo\\(0\\)\n\n    // 6. íšŒìˆ˜ ì˜ˆì • ì”ì—¬ 200p\n    val remainingPending = pendingPointRecoveryRepository.sumPendingAmount\\(userId\\)\n    assertThat\\(remainingPending\\).isEqualTo\\(200\\)\n\n    // 7. ì‚¬ìš© ê°€ëŠ¥ ì”ì•¡ 0p\n    val balance = pointLedgerRepository.sumAvailableBalance\\(userId\\)\n    assertThat\\(balance\\).isEqualTo\\(0\\)\n}\n\n@Test\nfun `E2E - ì—¬ëŸ¬ ë£°ë › ì·¨ì†Œ í›„ ìˆœì°¨ íšŒìˆ˜`\\(\\) {\n    // 1. ë£°ë › A \\(1000p\\) â†’ ì „ì•¡ ì‚¬ìš© â†’ ì·¨ì†Œ \\(íšŒìˆ˜ ì˜ˆì • 1000p\\)\n    val spinA = rouletteService.spin\\(userId\\)\n    usePoints\\(userId, spinA.amount\\)\n    adminService.cancelRoulette\\(spinA.historyId\\)\n\n    // 2. ë‹¤ìŒ ë‚  ë£°ë › B \\(800p\\) â†’ ì „ì•¡ ì‚¬ìš© â†’ ì·¨ì†Œ \\(íšŒìˆ˜ ì˜ˆì • 800p\\)\n    advanceTimeToNextDay\\(\\)\n    val spinB = rouletteService.spin\\(userId\\)\n    usePoints\\(userId, spinB.amount\\)\n    adminService.cancelRoulette\\(spinB.historyId\\)\n\n    // 3. ì´ íšŒìˆ˜ ì˜ˆì • 1800p\n    val totalPending = pendingPointRecoveryRepository.sumPendingAmount\\(userId\\)\n    assertThat\\(totalPending\\).isEqualTo\\(1800\\)\n\n    // 4. ë‹¤ìŒ ë‚  ë£°ë › ì°¸ì—¬ \\(600p\\)\n    advanceTimeToNextDay\\(\\)\n    val spin3 = rouletteService.spin\\(userId\\)\n    assume\\(\\).that\\(spin3.amount\\).isEqualTo\\(600\\)\n\n    // 5. 600p ì „ì•¡ íšŒìˆ˜ ì°¨ê° \\(FIFO: ë£°ë › Aë¶€í„°\\)\n    assertThat\\(spin3.recoveredAmount\\).isEqualTo\\(600\\)\n    assertThat\\(spin3.actualGrantedAmount\\).isEqualTo\\(0\\)\n\n    // 6. íšŒìˆ˜ ì˜ˆì • ì”ì—¬ 1200p\n    val remainingPending = pendingPointRecoveryRepository.sumPendingAmount\\(userId\\)\n    assertThat\\(remainingPending\\).isEqualTo\\(1200\\)\n}\n```\n\n---\n\n## 7. êµ¬í˜„ ìˆœì„œ \\(Phaseë³„\\)\n\n### Phase 1: ë°ì´í„° ëª¨ë¸ \\(1-2ì‹œê°„\\)\n1. `PendingPointRecovery` ì—”í‹°í‹° ì‘ì„±\n2. `PendingPointRecoveryRepository` ì‘ì„±\n3. `PointType` enumì— `RECOVERY_DEDUCTION` ì¶”ê°€\n4. DB ìŠ¤í‚¤ë§ˆ ìƒì„± \\(ë¡œì»¬ í…ŒìŠ¤íŠ¸\\)\n\n### Phase 2: Backend ë¡œì§ \\(2-3ì‹œê°„\\)\n1. `AdminService.cancelRoulette\\(\\)` ìˆ˜ì •\n2. `RouletteService.spin\\(\\)` ìˆ˜ì •\n3. `PointService.getPendingRecovery\\(\\)` ì¶”ê°€\n4. DTO ì‘ì„± \\(`CancelRouletteResponse`, `SpinResponse`, `PendingRecoveryResponse` ìˆ˜ì •\\)\n\n### Phase 3: API ì—”ë“œí¬ì¸íŠ¸ \\(1ì‹œê°„\\)\n1. `PointController`ì— `/pending-recovery` ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€\n2. Swagger ë¬¸ì„œ ì—…ë°ì´íŠ¸\n\n### Phase 4: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ \\(2-3ì‹œê°„\\)\n1. `PendingPointRecovery` ì—”í‹°í‹° í…ŒìŠ¤íŠ¸\n2. `AdminService.cancelRoulette\\(\\)` í…ŒìŠ¤íŠ¸ \\(3ê°€ì§€ ì¼€ì´ìŠ¤\\)\n3. `RouletteService.spin\\(\\)` í…ŒìŠ¤íŠ¸ \\(4ê°€ì§€ ì¼€ì´ìŠ¤\\)\n\n### Phase 5: í†µí•© í…ŒìŠ¤íŠ¸ \\(2-3ì‹œê°„\\)\n1. E2E ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸\n2. ë™ì‹œì„± í…ŒìŠ¤íŠ¸\n\n### Phase 6: í”„ë¡ íŠ¸ì—”ë“œ \\(2-3ì‹œê°„\\)\n1. `PendingRecoveryResponse` íƒ€ì… ì •ì˜\n2. `PointsPage` ìˆ˜ì • \\(íšŒìˆ˜ ì˜ˆì • ì„¹ì…˜ ì¶”ê°€\\)\n3. `RoulettePage` ìˆ˜ì • \\(íšŒìˆ˜ ì°¨ê° ì•Œë¦¼\\)\n4. ì”ì•¡ ì¡°íšŒ ë¡œì§ ìˆ˜ì • \\(íšŒìˆ˜ ì˜ˆì • > 0ì´ë©´ ì”ì•¡ 0 í‘œì‹œ\\)\n\n### Phase 7: ì–´ë“œë¯¼ \\(1-2ì‹œê°„\\)\n1. `RouletteHistoryPage` ì‘ì„± \\(ì‹ ê·œ í˜ì´ì§€\\)\n2. ë£°ë › ì·¨ì†Œ ê²°ê³¼ í‘œì‹œ UI\n\n### Phase 8: ë°°í¬ \\(1ì‹œê°„\\)\n1. DB ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ \\(Neon\\)\n2. ë°±ì—”ë“œ ë°°í¬ \\(Render\\)\n3. í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬ \\(Vercel\\)\n4. ì–´ë“œë¯¼ ë°°í¬ \\(Vercel\\)\n5. í†µí•© í…ŒìŠ¤íŠ¸\n\n**ì´ ì˜ˆìƒ ì‹œê°„**: 12-18ì‹œê°„\n\n---\n\n## 8. ë¡¤ë°± ê³„íš\n\në§Œì•½ ë°°í¬ í›„ ë¬¸ì œê°€ ë°œìƒí•˜ë©´:\n\n1. **ì¦‰ì‹œ ë¡¤ë°±**: ì´ì „ ë²„ì „ìœ¼ë¡œ ë˜ëŒë¦¼\n2. **ë°ì´í„° ì •í•©ì„± í™•ì¸**: `PendingPointRecovery` í…Œì´ë¸” ë°ì´í„° ê²€ì¦\n3. **ìˆ˜ë™ ë³µêµ¬** \\(í•„ìš” ì‹œ\\):\n   - íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ ìˆ˜ë™ ì¡°ì •\n   - ì˜ëª» ì°¨ê°ëœ í¬ì¸íŠ¸ ë³µì›\n\n**ë¡¤ë°± ì‹œ ë°ì´í„° ì†ì‹¤ ë°©ì§€**:\n- `PendingPointRecovery` í…Œì´ë¸”ì€ ì‚­ì œí•˜ì§€ ì•ŠìŒ\n- ë¡¤ë°± í›„ì—ë„ ë°ì´í„° ìœ ì§€ â†’ ë²„ê·¸ ìˆ˜ì • í›„ ì¬ë°°í¬ ì‹œ ì¼ê´€ì„± ìœ ì§€\n\n---\n\n## 9. ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼\n\në°°í¬ í›„ ëª¨ë‹ˆí„°ë§ ëŒ€ìƒ:\n\n1. **íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ ì¶”ì´**:\n   - ì´ íšŒìˆ˜ ì˜ˆì • ê¸ˆì•¡ ì¦ê°€ ì¶”ì„¸ í™•ì¸\n   - ë¹„ì •ìƒì  ê¸‰ì¦ ì‹œ ì•Œë¦¼\n\n2. **íšŒìˆ˜ ì°¨ê° ì„±ê³µë¥ **:\n   - ë£°ë › ì°¸ì—¬ ì‹œ íšŒìˆ˜ ì˜ˆì • ì°¨ê° ì„±ê³µ ê±´ìˆ˜\n   - ì‹¤íŒ¨ ê±´ìˆ˜ \\(ë½ íƒ€ì„ì•„ì›ƒ ë“±\\)\n\n3. **ì—ëŸ¬ ë¡œê·¸**:\n   - `PendingPointRecoveryRepository` ê´€ë ¨ ì—ëŸ¬\n   - ë™ì‹œì„± ê´€ë ¨ ì—ëŸ¬ \\(ë°ë“œë½, íƒ€ì„ì•„ì›ƒ\\)\n\n4. **ì„±ëŠ¥ ì§€í‘œ**:\n   - ë£°ë › ì°¸ì—¬ ì‘ë‹µ ì‹œê°„ \\(íšŒìˆ˜ ì˜ˆì • ì¡°íšŒ/ì°¨ê° ì¶”ê°€ë¡œ ì¸í•œ ì§€ì—°\\)\n   - DB ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„\n\n**ì•Œë¦¼ ì¡°ê±´**:\n- íšŒìˆ˜ ì˜ˆì • ì´ì•¡ > 100ë§Œp\n- ë£°ë › ì°¸ì—¬ ì‘ë‹µ ì‹œê°„ > 3ì´ˆ\n- ë™ì‹œì„± ê´€ë ¨ ì—ëŸ¬ > 10ê±´/ì‹œê°„\n\n---\n\n## 10. ë¬¸ì„œ ì—…ë°ì´íŠ¸\n\nêµ¬í˜„ ì™„ë£Œ í›„ ë‹¤ìŒ ë¬¸ì„œ ì—…ë°ì´íŠ¸:\n\n1. **SPEC.md**:\n   - PDP-9 ì¶”ê°€: \"ë£°ë › ì·¨ì†Œ ì‹œ í¬ì¸íŠ¸ íšŒìˆ˜ ì˜ˆì • ì •ì±…\"\n   - ì—”í‹°í‹° ì •ì˜ì— `PendingPointRecovery` ì¶”ê°€\n   - API ì—”ë“œí¬ì¸íŠ¸ `/api/user/points/pending-recovery` ì¶”ê°€\n\n2. **CLAUDE.md**:\n   - ì„¹ì…˜ 6 \\(ì—£ì§€ ì¼€ì´ìŠ¤\\)ì— \"íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ê°€ ìˆìœ¼ë©´ ì‚¬ìš© ê°€ëŠ¥ ì”ì•¡ = 0\" ì¶”ê°€\n\n3. **HANDOFF.md**:\n   - êµ¬í˜„ ì™„ë£Œ í•­ëª©ì— \"í¬ì¸íŠ¸ íšŒìˆ˜ ì˜ˆì • ì‹œìŠ¤í…œ\" ì¶”ê°€\n\n4. **PROMPT.md**:\n   - ì´ ì„¤ê³„ ì„¸ì…˜ ë¡œê·¸ append\n\n---\n\n## 11. í–¥í›„ ê°œì„  ì‚¬í•­\n\ní˜„ì¬ ìš”êµ¬ì‚¬í•­ì„ ë²—ì–´ë‚œ ì¶”ê°€ ê¸°ëŠ¥ \\(ë‚˜ì¤‘ì— ê³ ë ¤\\):\n\n1. **íšŒìˆ˜ ì˜ˆì • ë§Œë£Œ ì •ì±…**:\n   - í˜„ì¬ëŠ” ìœ íš¨ê¸°ê°„ ì—†ìŒ\n   - í–¥í›„: 6ê°œì›” ê²½ê³¼ ì‹œ ìë™ ì‚­ì œ \\(ì„ íƒì \\)\n\n2. **íšŒìˆ˜ ì˜ˆì • í¬ê¸° ê¸°ëŠ¥**:\n   - ì–´ë“œë¯¼ì´ íŠ¹ì • íšŒìˆ˜ ì˜ˆì • ê±´ì„ í¬ê¸° \\(ì‚¬ìš©ì í˜œíƒ\\)\n   - `status = WAIVED` ì¶”ê°€\n\n3. **ë¶€ë¶„ íšŒìˆ˜ ì˜ˆì • í¬ê¸°**:\n   - 1000p íšŒìˆ˜ ì˜ˆì • ì¤‘ 500pë§Œ í¬ê¸°\n\n4. **íšŒìˆ˜ ì˜ˆì • ì•Œë¦¼**:\n   - íšŒìˆ˜ ì˜ˆì •ì´ ë°œìƒí•˜ë©´ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ \\(ì´ë©”ì¼, í‘¸ì‹œ\\)\n\n5. **íšŒìˆ˜ ì˜ˆì • ìƒì„¸ ë‚´ì—­**:\n   - ì–´ë–¤ ë£°ë ›ì—ì„œ ì–¼ë§ˆë‚˜ ì‚¬ìš©í–ˆëŠ”ì§€ ìƒì„¸ ì¶”ì \n\n---\n\n## ë¶€ë¡: ì˜ˆìƒ ì§ˆë¬¸ê³¼ ë‹µë³€\n\n### Q1: íšŒìˆ˜ ì˜ˆì • í¬ì¸íŠ¸ì— ìœ íš¨ê¸°ê°„ì´ ì—†ìœ¼ë©´ ë¬´í•œì • ëˆ„ì ë˜ì§€ ì•Šë‚˜ìš”?\n\nA: ë§ìŠµë‹ˆë‹¤. ì´ë¡ ì ìœ¼ë¡œ ëˆ„ì  ê°€ëŠ¥í•˜ì§€ë§Œ, ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ìœ íš¨ê¸°ê°„ ì—†ìŒì´ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ, í–¥í›„ ê°œì„  ì‚¬í•­\\(ì„¹ì…˜ 11\\)ì—ì„œ 6ê°œì›” ë§Œë£Œ ì •ì±…ì„ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n### Q2: íšŒìˆ˜ ì˜ˆì •ì´ 1ë§Œp ì´ìƒ ìŒ“ì´ë©´ ì‚¬ìš©ìê°€ ì˜ì›íˆ í¬ì¸íŠ¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ì§€ ì•Šë‚˜ìš”?\n\nA: ë„¤, ê·¸ëŸ° ìƒí™©ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ì‚¬ê²°ì • ì‚¬í•­ì´ë©°, í˜„ì¬ ìš”êµ¬ì‚¬í•­ì€ \"íšŒìˆ˜ ì˜ˆì •ì´ ìˆìœ¼ë©´ ì‚¬ìš© ë¶ˆê°€\"ì…ë‹ˆë‹¤. í–¥í›„ ê°œì„ ìœ¼ë¡œ:\n- íšŒìˆ˜ ì˜ˆì • ìƒí•œì„  ì„¤ì • \\(ì˜ˆ: ìµœëŒ€ 5,000p\\)\n- ì´ˆê³¼ë¶„ì€ ìë™ í¬ê¸°\n- ë˜ëŠ” ì¼ì • ë¹„ìœ¨ë§Œ ì°¨ê° \\(ì˜ˆ: ì§€ê¸‰ì•¡ì˜ 50%ê¹Œì§€ë§Œ\\)\n\n### Q3: ë™ì‹œì„± í…ŒìŠ¤íŠ¸ì—ì„œ ë½ íƒ€ì„ì•„ì›ƒì´ ë°œìƒí•˜ë©´ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?\n\nA: Spring Data JPAì˜ ê¸°ë³¸ ë½ íƒ€ì„ì•„ì›ƒì€ ë¬´ì œí•œì…ë‹ˆë‹¤. ë§Œì•½ íƒ€ì„ì•„ì›ƒì„ ì„¤ì •í•˜ë ¤ë©´:\n```kotlin\n@Lock\\(LockModeType.PESSIMISTIC_WRITE\\)\n@QueryHints\\(QueryHint\\(name = \"javax.persistence.lock.timeout\", value = \"3000\"\\)\\)\n```\níƒ€ì„ì•„ì›ƒ ë°œìƒ ì‹œ `PessimisticLockException` â†’ ì‚¬ìš©ìì—ê²Œ \"ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„\" ì•ˆë‚´\n\n### Q4: íšŒìˆ˜ ì˜ˆì • ì°¨ê° ì‹œ FIFOê°€ ë³´ì¥ë˜ë‚˜ìš”?\n\nA: ë„¤, `findPendingByUserIdForUpdate`ì˜ `ORDER BY createdAt ASC`ë¡œ ë³´ì¥ë©ë‹ˆë‹¤. ë¹„ê´€ì  ë½ìœ¼ë¡œ ë™ì‹œì„±ë„ ì œì–´ë©ë‹ˆë‹¤.\n\n### Q5: ì£¼ë¬¸ ì·¨ì†ŒëŠ” ì™œ íšŒìˆ˜ ì˜ˆì • ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ì§€ ì•Šë‚˜ìš”?\n\nA: ìš”êµ¬ì‚¬í•­ì— \"ë£°ë › ì·¨ì†Œë§Œ ì ìš©, ì£¼ë¬¸ ì·¨ì†ŒëŠ” ì œì™¸\"ë¡œ ëª…ì‹œë˜ì—ˆìŠµë‹ˆë‹¤. ì£¼ë¬¸ ì·¨ì†ŒëŠ” ê¸°ì¡´ëŒ€ë¡œ í¬ì¸íŠ¸ í™˜ë¶ˆ \\(balance ë³µì›\\) ë°©ì‹ì„ ìœ ì§€í•©ë‹ˆë‹¤.\n\nPLAN_CONTENT)",
      "Bash(find:*)",
      "Bash(xargs cat:*)"
    ]
  }
}
